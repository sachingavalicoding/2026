<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vehicle Rental Calendar</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background-color: #f9fafb;
      min-height: 100vh;
    }

    .header {
      background-color: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 1.5rem 2rem;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-title h1 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #111827;
    }

    .header-title p {
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }

    .header-actions {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .search-box {
      position: relative;
    }

    .search-box input {
      padding: 0.5rem 0.75rem 0.5rem 2.25rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      width: 250px;
      outline: none;
    }

    .search-box input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
    }

    .btn {
      padding: 0.5rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      background: white;
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:hover {
      background-color: #f9fafb;
    }

    .main-content {
      padding: 1.5rem 2rem;
      max-width: 100%;
    }

    .calendar-controls {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem 1.5rem;
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .controls-info {
      font-size: 0.875rem;
      color: #6b7280;
    }

    .month-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .nav-btn {
      padding: 0.5rem;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 0.375rem;
      color: #6b7280;
    }

    .nav-btn:hover {
      background-color: #f3f4f6;
    }

    .current-month {
      font-size: 1rem;
      font-weight: 600;
      color: #111827;
      min-width: 160px;
      text-align: center;
    }

    .calendar-container {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      overflow: hidden;
    }

    .table-wrapper {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead tr {
      background-color: #f9fafb;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      padding: 0.75rem 0.5rem;
      text-align: center;
      font-size: 0.875rem;
      font-weight: 600;
      color: #374151;
      border-right: 1px solid #e5e7eb;
    }

    th:first-child {
      position: sticky;
      left: 0;
      z-index: 20;
      background-color: #f9fafb;
      text-align: left;
      padding-left: 1.5rem;
      min-width: 280px;
    }

    th:last-child {
      position: sticky;
      right: 0;
      z-index: 20;
      background-color: #f9fafb;
      min-width: 100px;
    }

    .day-header {
      min-width: 40px;
    }

    .day-name {
      font-size: 0.75rem;
      color: #9ca3af;
      font-weight: 400;
      display: block;
      margin-bottom: 0.25rem;
    }

    .day-number {
      font-size: 0.875rem;
      font-weight: 600;
      color: #111827;
    }

    .weekend {
      background-color: #f3f4f6;
    }

    tbody tr {
      border-bottom: 1px solid #e5e7eb;
    }

    tbody tr:nth-child(even) {
      background-color: #f9fafb;
    }

    tbody tr:hover {
      background-color: #eff6ff;
    }

    td {
      padding: 0;
      border-right: 1px solid #e5e7eb;
    }

    td:first-child {
      position: sticky;
      left: 0;
      z-index: 10;
      background-color: inherit;
      padding: 1rem 1.5rem;
    }

    td:last-child {
      position: sticky;
      right: 0;
      z-index: 10;
      background-color: inherit;
      padding: 1rem;
      text-align: center;
    }

    .vehicle-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .vehicle-name {
      font-size: 0.875rem;
      font-weight: 500;
      color: #111827;
    }

    .vehicle-reg {
      font-size: 0.75rem;
      color: #6b7280;
    }

    .calendar-cell {
      height: 56px;
      width: 100%;
      cursor: pointer;
      user-select: none;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
      color: #374151;
    }

    /* Available - Green */
    .calendar-cell.available {
      background-color: #d1fae5;
      color: #065f46;
    }

    .calendar-cell.available:hover {
      background-color: #a7f3d0;
    }

    /* Blocked - Red */
    .calendar-cell.blocked {
      background-color: #fecaca;
      color: #991b1b;
      cursor: not-allowed;
    }

    /* Temporary Selection - Yellow */
    .calendar-cell.temp-block {
      background-color: #fef3c7;
      color: #92400e;
      border: 2px solid #f59e0b;
    }

    .days-count {
      font-size: 0.875rem;
      font-weight: 600;
      color: #111827;
    }

    .legend {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1rem 1.5rem;
      margin-top: 1rem;
    }

    .legend-items {
      display: flex;
      gap: 1.5rem;
      align-items: center;
      font-size: 0.875rem;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-box {
      width: 40px;
      height: 28px;
      border: 1px solid #d1d5db;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .legend-available {
      background-color: #d1fae5;
      color: #065f46;
    }

    .legend-blocked {
      background-color: #fecaca;
      color: #991b1b;
    }

    .legend-temp {
      background-color: #fef3c7;
      color: #92400e;
      border: 2px solid #f59e0b;
    }

    .legend-weekend {
      background-color: #f3f4f6;
    }

    .action-buttons {
      margin-top: 1rem;
      display: flex;
      gap: 0.75rem;
    }

    .btn-confirm {
      background-color: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }

    .btn-confirm:hover {
      background-color: #2563eb;
    }

    .btn-cancel {
      background-color: #ef4444;
      color: white;
      border-color: #ef4444;
    }

    .btn-cancel:hover {
      background-color: #dc2626;
    }

    .btn-confirm:disabled,
    .btn-cancel:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <div class="header-title">
        <h1>Vehicle Rental Calendar</h1>
        <p>Manage equipment bookings and availability</p>
      </div>
      <div class="header-actions">
        <div class="search-box">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" id="searchInput" placeholder="Search vehicles...">
        </div>
        <button class="btn" onclick="exportData()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Export
        </button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="calendar-controls">
      <div class="controls-info">
        Select available dates (A) to block â€¢ Click and drag to select range
      </div>
      <div class="month-nav">
        <button class="nav-btn" onclick="prevMonth()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <div class="current-month" id="currentMonth"></div>
        <button class="nav-btn" onclick="nextMonth()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
    </div>

    <div class="calendar-container">
      <div class="table-wrapper">
        <table id="calendarTable">
          <thead id="tableHead"></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-confirm" id="confirmBtn" onclick="confirmSelection()" disabled>
        Confirm Blocking
      </button>
      <button class="btn btn-cancel" id="cancelBtn" onclick="cancelSelection()" disabled>
        Cancel Selection
      </button>
    </div>

    <div class="legend">
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-box legend-available">A</div>
          <span>Available - Can be selected</span>
        </div>
        <div class="legend-item">
          <div class="legend-box legend-blocked">B</div>
          <span>Blocked - Cannot be selected</span>
        </div>
        <div class="legend-item">
          <div class="legend-box legend-temp">T</div>
          <span>Temp Selection - Pending confirmation</span>
        </div>
        <div class="legend-item">
          <div class="legend-box legend-weekend"></div>
          <span>Weekend</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const vehicles = [
      { id: 1, name: 'JCB 3DX Backhoe Loader', registration: 'MH-12-AB-1234' },
      { id: 2, name: 'Tata Hitachi ZX200 Excavator', registration: 'MH-12-CD-5678' },
      { id: 3, name: 'Mahindra Earth Master', registration: 'MH-12-EF-9012' },
      { id: 4, name: 'JCB JS130 Excavator', registration: 'MH-12-GH-3456' },
      { id: 5, name: 'CAT 320D Excavator', registration: 'MH-12-IJ-7890' },
      { id: 6, name: 'Hyundai R140 Excavator', registration: 'MH-12-KL-2345' },
      { id: 7, name: 'JCB 3CX Super', registration: 'MH-12-MN-6789' },
      { id: 8, name: 'Volvo EC140D Excavator', registration: 'MH-12-OP-0123' }
    ];

    let currentMonth = 0;
    let currentYear = 2025;
    let blockedDates = {}; // Permanently blocked dates
    let tempSelection = {}; // Temporary selection
    let isSelecting = false;
    let selectionStart = null;
    let searchTerm = '';

    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    function getDaysInMonth(month, year) {
      return new Date(year, month + 1, 0).getDate();
    }

    function getDayName(date, month, year) {
      const d = new Date(year, month, date);
      return dayNames[d.getDay()];
    }

    function isWeekend(date, month, year) {
      const d = new Date(year, month, date);
      return d.getDay() === 0 || d.getDay() === 6;
    }

    function getCellKey(vehicleId, date) {
      return `${vehicleId}-${currentYear}-${currentMonth}-${date}`;
    }

    function getBlockedDays(vehicleId) {
      const daysInMonth = getDaysInMonth(currentMonth, currentYear);
      let days = 0;
      for (let d = 1; d <= daysInMonth; d++) {
        if (blockedDates[getCellKey(vehicleId, d)]) days++;
      }
      return days;
    }

    function updateMonthDisplay() {
      document.getElementById('currentMonth').textContent = `${months[currentMonth]} ${currentYear}`;
    }

    function prevMonth() {
      if (currentMonth === 0) {
        currentMonth = 11;
        currentYear--;
      } else {
        currentMonth--;
      }
      tempSelection = {};
      updateButtons();
      renderCalendar();
    }

    function nextMonth() {
      if (currentMonth === 11) {
        currentMonth = 0;
        currentYear++;
      } else {
        currentMonth++;
      }
      tempSelection = {};
      updateButtons();
      renderCalendar();
    }

    function isBlocked(key) {
      return blockedDates[key] === true;
    }

    function isAvailable(key) {
      return !isBlocked(key);
    }

    function handleMouseDown(vehicleId, date, e) {
      e.preventDefault();
      const key = getCellKey(vehicleId, date);
      
      // Only allow selection of available dates
      if (!isAvailable(key)) {
        return;
      }
      
      isSelecting = true;
      selectionStart = { vehicleId, date };
      tempSelection = { [key]: true };
      
      updateButtons();
      renderCalendar();
    }

    function handleMouseEnter(vehicleId, date) {
      if (isSelecting && selectionStart && selectionStart.vehicleId === vehicleId) {
        const start = Math.min(selectionStart.date, date);
        const end = Math.max(selectionStart.date, date);
        
        tempSelection = {};
        let canSelect = true;
        
        // Check if all dates in range are available
        for (let d = start; d <= end; d++) {
          const key = getCellKey(vehicleId, d);
          if (!isAvailable(key)) {
            canSelect = false;
            break;
          }
        }
        
        // Only add to temp selection if all dates are available
        if (canSelect) {
          for (let d = start; d <= end; d++) {
            const key = getCellKey(vehicleId, d);
            tempSelection[key] = true;
          }
        }
        
        renderCalendar();
      }
    }

    function handleMouseUp() {
      isSelecting = false;
      selectionStart = null;
    }

    function confirmSelection() {
      // Move temp selection to permanent blocked dates
      Object.keys(tempSelection).forEach(key => {
        blockedDates[key] = true;
      });
      tempSelection = {};
      updateButtons();
      renderCalendar();
    }

    function cancelSelection() {
      tempSelection = {};
      updateButtons();
      renderCalendar();
    }

    function updateButtons() {
      const hasSelection = Object.keys(tempSelection).length > 0;
      document.getElementById('confirmBtn').disabled = !hasSelection;
      document.getElementById('cancelBtn').disabled = !hasSelection;
    }

    function getFilteredVehicles() {
      return vehicles.filter(v => 
        v.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        v.registration.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }

    function getCellStatus(key) {
      if (tempSelection[key]) {
        return 'temp-block';
      } else if (isBlocked(key)) {
        return 'blocked';
      } else {
        return 'available';
      }
    }

    function getCellLabel(key) {
      if (tempSelection[key]) {
        return 'T';
      } else if (isBlocked(key)) {
        return 'B';
      } else {
        return 'A';
      }
    }

    function renderCalendar() {
      updateMonthDisplay();
      const daysInMonth = getDaysInMonth(currentMonth, currentYear);
      const filteredVehicles = getFilteredVehicles();
      
      // Render header
      let headerHTML = '<tr>';
      headerHTML += '<th>Equipment</th>';
      
      for (let d = 1; d <= daysInMonth; d++) {
        const weekend = isWeekend(d, currentMonth, currentYear);
        headerHTML += `<th class="day-header ${weekend ? 'weekend' : ''}">
          <span class="day-name">${getDayName(d, currentMonth, currentYear)}</span>
          <span class="day-number">${d}</span>
        </th>`;
      }
      
      headerHTML += '<th>Blocked Days</th>';
      headerHTML += '</tr>';
      document.getElementById('tableHead').innerHTML = headerHTML;
      
      // Render body
      let bodyHTML = '';
      filteredVehicles.forEach(vehicle => {
        bodyHTML += '<tr>';
        bodyHTML += `<td>
          <div class="vehicle-info">
            <span class="vehicle-name">${vehicle.name}</span>
            <span class="vehicle-reg">${vehicle.registration}</span>
          </div>
        </td>`;
        
        for (let d = 1; d <= daysInMonth; d++) {
          const key = getCellKey(vehicle.id, d);
          const weekend = isWeekend(d, currentMonth, currentYear);
          const status = getCellStatus(key);
          const label = getCellLabel(key);
          
          bodyHTML += `<td class="${weekend ? 'weekend' : ''}">
            <div class="calendar-cell ${status}" 
                 data-cell="${key}"
                 onmousedown="handleMouseDown(${vehicle.id}, ${d}, event)"
                 onmouseenter="handleMouseEnter(${vehicle.id}, ${d})">
              ${label}
            </div>
          </td>`;
        }
        
        const blockedDays = getBlockedDays(vehicle.id);
        bodyHTML += `<td><span class="days-count">${blockedDays}</span></td>`;
        bodyHTML += '</tr>';
      });
      
      document.getElementById('tableBody').innerHTML = bodyHTML;
    }

    function exportData() {
      let csvContent = "Vehicle,Registration,";
      const daysInMonth = getDaysInMonth(currentMonth, currentYear);
      
      for (let d = 1; d <= daysInMonth; d++) {
        csvContent += `${d},`;
      }
      csvContent += "Total Blocked Days\n";
      
      vehicles.forEach(vehicle => {
        csvContent += `"${vehicle.name}","${vehicle.registration}",`;
        for (let d = 1; d <= daysInMonth; d++) {
          const key = getCellKey(vehicle.id, d);
          csvContent += isBlocked(key) ? 'B,' : 'A,';
        }
        csvContent += `${getBlockedDays(vehicle.id)}\n`;
      });
      
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `vehicle-availability-${months[currentMonth]}-${currentYear}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);
    }

    document.addEventListener('mouseup', handleMouseUp);
    
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchTerm = e.target.value;
      renderCalendar();
    });

    // Initialize with some blocked dates for demo
    blockedDates[getCellKey(1, 5)] = true;
    blockedDates[getCellKey(1, 6)] = true;
    blockedDates[getCellKey(1, 7)] = true;
    blockedDates[getCellKey(2, 10)] = true;
    blockedDates[getCellKey(2, 11)] = true;

    renderCalendar();
  </script>
</body>
</html>